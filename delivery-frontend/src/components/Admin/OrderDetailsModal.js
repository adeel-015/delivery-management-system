import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useState } from 'react';
import { getOrderDetails } from '../../services/api';
export default function OrderDetailsModal({ isOpen, orderId, onClose }) {
    const [details, setDetails] = useState(null);
    const [loading, setLoading] = useState(false);
    useEffect(() => {
        if (!isOpen)
            return;
        setLoading(true);
        getOrderDetails(orderId).then((r) => setDetails(r.data)).catch(console.error).finally(() => setLoading(false));
    }, [isOpen, orderId]);
    const formatDate = (date) => {
        return new Date(date).toLocaleString();
    };
    const formatDuration = (ms) => {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        if (days > 0)
            return `${days}d ${hours % 24}h ${minutes % 60}m`;
        if (hours > 0)
            return `${hours}h ${minutes % 60}m`;
        if (minutes > 0)
            return `${minutes}m ${seconds % 60}s`;
        return `${seconds}s`;
    };
    if (!isOpen)
        return null;
    const order = details?.order;
    const stageTimes = details?.stageTimes || [];
    const history = details?.history || [];
    return (_jsx("div", { className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4", children: _jsxs("div", { className: "bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl", children: [_jsxs("div", { className: "bg-linear-to-r from-purple-600 to-indigo-600 text-white px-6 py-4", children: [_jsx("h3", { className: "text-2xl font-bold", children: "Order Details" }), _jsxs("p", { className: "text-purple-100 text-sm mt-1", children: ["Order ID: ", orderId] })] }), _jsx("div", { className: "overflow-auto p-6 flex-1", children: loading ? (_jsx("div", { className: "flex items-center justify-center py-12", children: _jsx("div", { className: "animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600" }) })) : order ? (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "text-lg font-semibold text-gray-800 mb-3", children: "Order Information" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-600", children: "Order ID" }), _jsx("p", { className: "font-mono text-sm font-medium", children: order._id })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-600", children: "Current Stage" }), _jsxs("p", { className: "font-medium", children: [order.currentStage, " - ", order.stageName || 'Unknown'] })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-600", children: "Items" }), _jsx("p", { className: "font-medium", children: order.items?.join(', ') || 'N/A' })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-600", children: "Status" }), _jsx("p", { className: `font-medium ${order.isDeleted ? 'text-red-600' : 'text-green-600'}`, children: order.isDeleted ? 'Deleted' : 'Active' })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-600", children: "Created At" }), _jsx("p", { className: "font-medium", children: formatDate(order.createdAt) })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-600", children: "Last Updated" }), _jsx("p", { className: "font-medium", children: formatDate(order.updatedAt) })] })] })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs("div", { className: "bg-blue-50 rounded-lg p-4", children: [_jsx("h4", { className: "text-lg font-semibold text-blue-900 mb-3", children: "Buyer Information" }), order.buyerId ? (_jsxs("div", { className: "space-y-2", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-blue-700", children: "Name" }), _jsx("p", { className: "font-medium", children: order.buyerId.name || 'N/A' })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-blue-700", children: "Email" }), _jsx("p", { className: "font-medium", children: order.buyerId.email || 'N/A' })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-blue-700", children: "ID" }), _jsx("p", { className: "font-mono text-xs", children: order.buyerId._id || 'N/A' })] })] })) : (_jsx("p", { className: "text-blue-800 italic", children: "No buyer associated" }))] }), _jsxs("div", { className: "bg-green-50 rounded-lg p-4", children: [_jsx("h4", { className: "text-lg font-semibold text-green-900 mb-3", children: "Seller Information" }), order.sellerId ? (_jsxs("div", { className: "space-y-2", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-green-700", children: "Name" }), _jsx("p", { className: "font-medium", children: order.sellerId.name || 'N/A' })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-green-700", children: "Email" }), _jsx("p", { className: "font-medium", children: order.sellerId.email || 'N/A' })] }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-green-700", children: "ID" }), _jsx("p", { className: "font-mono text-xs", children: order.sellerId._id || 'N/A' })] })] })) : (_jsx("p", { className: "text-green-800 italic", children: "No seller assigned" }))] })] }), stageTimes.length > 0 && (_jsxs("div", { className: "bg-yellow-50 rounded-lg p-4", children: [_jsx("h4", { className: "text-lg font-semibold text-yellow-900 mb-3", children: "Stage Durations" }), _jsx("div", { className: "space-y-2", children: stageTimes.map((st, idx) => (_jsxs("div", { className: "flex justify-between items-center bg-white rounded px-3 py-2", children: [_jsxs("span", { className: "text-sm font-medium text-gray-700", children: [st.from, " \u2192 ", st.to] }), _jsx("span", { className: "text-sm font-bold text-yellow-700", children: formatDuration(st.durationMs) })] }, idx))) })] })), _jsxs("div", { className: "bg-purple-50 rounded-lg p-4", children: [_jsx("h4", { className: "text-lg font-semibold text-purple-900 mb-3", children: "Order History" }), _jsx("div", { className: "space-y-3", children: history.map((h, idx) => (_jsxs("div", { className: "bg-white rounded-lg p-3 border-l-4 border-purple-500", children: [_jsxs("div", { className: "flex justify-between items-start mb-1", children: [_jsx("span", { className: "font-semibold text-purple-900", children: h.stage }), _jsx("span", { className: "text-xs text-gray-500", children: formatDate(h.timestamp) })] }), h.actorName && (_jsxs("p", { className: "text-sm text-gray-600", children: ["By: ", _jsx("span", { className: "font-medium", children: h.actorName }), h.action && ` - ${h.action}`] }))] }, idx))) })] })] })) : (_jsx("div", { className: "text-center py-8 text-gray-500", children: "No details available" })) }), _jsx("div", { className: "bg-gray-50 px-6 py-4 border-t flex justify-end", children: _jsx("button", { onClick: onClose, className: "px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors", children: "Close" }) })] }) }));
}
